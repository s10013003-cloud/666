<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºæ…§é–€å¸‚ V29 (ç ´ç‰†ç‰ˆ)</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; margin: 0; background: #f0f2f5; padding-bottom: 80px; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; min-height: 100vh; position: relative; }
        
        /* ç‹€æ…‹è¨ºæ–·æ¢ (æ–°) */
        #net-status { background: #333; color: yellow; text-align: center; padding: 10px; font-weight: bold; font-size: 14px; position: sticky; top: 0; z-index: 9999; }

        /* å°èˆª */
        .nav { display: flex; background: #fff; border-bottom: 3px solid #ddd; }
        .nav div { flex: 1; padding: 15px 0; text-align: center; font-weight: bold; color: #666; cursor: pointer; border-bottom: 3px solid transparent; }
        .nav div.active { color: #007bff; border-bottom: 3px solid #007bff; background: #f0f8ff; }

        /* æ ¼å­ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }
        .box { border: 2px solid #ddd; padding: 15px 5px; text-align: center; border-radius: 8px; cursor: pointer; background: #fff; min-height: 60px; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .box.ok { background: #d4edda !important; border-color: #28a745 !important; color: #155724; font-weight: bold; }
        .foreign { background: #f3e5f5; border: 2px solid #9c27b0; color: #6a1b9a; font-weight: bold; }

        /* å¸³å‹™è¡¨ */
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        td, th { border: 1px solid #ddd; padding: 5px; text-align: center; font-size: 14px; }
        .inp-m { width: 60px; text-align: center; padding: 5px; font-size: 16px; border: 1px solid #ccc; border-radius:4px; }

        /* æ¨¡å‹åœ– */
        #shelf-canvas { border: 2px solid #333; position: relative; width: 100%; height: 350px; background: #eee; overflow: hidden; }
        .shape { position: absolute; border: 2px solid #333; background: rgba(255,255,255,0.8); display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; padding:2px; text-align:center;}
        .shape.done { background: #28a745 !important; color: white !important; }
        .shape.selected { border: 3px solid red; z-index: 10; }

        /* é€šç”¨ */
        input, select, button, textarea { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #999; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        button { background: #007bff; color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-g { background: #28a745; } .btn-r { background: #dc3545; }
        .hide { display: none !important; }
        
        /* éˆ´éº */
        #bell { position: fixed; top: 50px; right: 10px; font-size: 24px; background: white; border-radius: 50%; padding: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 2000; cursor: pointer; }
        #badge { position: absolute; top: 0; right: 0; background: red; color: white; width: 15px; height: 15px; border-radius: 50%; font-size: 10px; text-align: center; line-height: 15px; display: none; }
        
        /* åœ–ç‰‡æ”¾å¤§ */
        #img-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: none; justify-content: center; align-items: center; }
        #img-modal img { max-width: 95%; max-height: 95%; border: 2px solid white; }
    </style>
</head>
<body>

<div class="container">
    <div id="net-status">æ­£åœ¨é€£æ¥è³‡æ–™åº«...</div>

    <div id="p-auth" style="padding:40px 20px; text-align:center;">
        <h2>ğŸª é–€å¸‚ V29</h2>
        <div id="b-login">
            <input id="lid" placeholder="å¸³è™Ÿ">
            <input id="lpw" type="password" placeholder="å¯†ç¢¼">
            <button onclick="login()">ç™»å…¥</button>
            <p onclick="swAuth(true)" style="color:blue; margin-top:20px; cursor:pointer;">æ²’æœ‰å¸³è™Ÿï¼Ÿè¨»å†Š</p>
        </div>
        <div id="b-reg" class="hide">
            <input id="rid" placeholder="è¨­å®šå¸³è™Ÿ">
            <input id="rnm" placeholder="çœŸå¯¦å§“å">
            <select id="rsf"><option>æ—©ç­</option><option>æ™šç­</option><option>ä¸»ç®¡</option></select>
            <input id="rpw" type="password" placeholder="è¨­å®šå¯†ç¢¼">
            <button class="btn-g" id="btn-reg" onclick="reg()">ç¢ºèªè¨»å†Š</button>
            <p onclick="swAuth(false)" style="color:blue; margin-top:20px; cursor:pointer;">è¿”å›ç™»å…¥</p>
        </div>
    </div>

    <div id="p-main" class="hide">
        <div style="background:#333; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center;">
            <span id="u-info">--</span>
            <button onclick="location.reload()" style="width:auto; padding:5px 15px; background:#555;">ç™»å‡º</button>
        </div>

        <div class="nav">
            <div onclick="go('stock')" id="n-stock" class="active">è£œè²¨</div>
            <div onclick="go('temp')" id="n-temp">å†°ç®±</div>
            <div onclick="go('count')" id="n-count">å¸³å‹™</div>
            <div onclick="go('svc')" id="n-svc">äº¤æ¥</div>
        </div>

        <div id="v-stock">
            <div class="section-header" style="background:#f3e5f5; padding:10px;">ğŸ”¥ é‡é»æª¢æŸ¥</div>
            <div class="grid">
                <div class="box foreign" id="s-noodle" onclick="chk('s-noodle','å¤–ç±æ³¡éºµ')">å¤–ç±æ³¡éºµ<br><small>å¾…æª¢</small></div>
                <div class="box foreign" id="s-cookie" onclick="chk('s-cookie','å¤–ç±é¤…ä¹¾')">å¤–ç±é¤…ä¹¾<br><small>å¾…æª¢</small></div>
            </div>
            <div class="section-header" style="padding:10px;">ğŸ“… æ¯æ—¥æ•ˆæœŸ</div>
            <div class="grid">
                <div class="box" id="c-f" onclick="chk('c-f','ç”Ÿé®®æ•ˆæœŸ')">ç”Ÿé®®æ•ˆæœŸ</div>
                <div class="box" id="c-d" onclick="chk('c-d','æ—¥é…æ•ˆæœŸ')">æ—¥é…æ•ˆæœŸ</div>
                <div class="box" id="c-b" onclick="chk('c-b','éºµåŒ…æ•ˆæœŸ')">éºµåŒ…æ•ˆæœŸ</div>
            </div>
            <div class="section-header" style="padding:10px;">ğŸ›’ æ¯æ—¥è£œè²¨</div>
            <div class="grid" id="daily-grid"></div>
            <div class="section-header" style="padding:10px;">ğŸ—“ï¸ æ¯æœˆæ•ˆæœŸåœ–</div>
            <div id="mgr-tool" class="hide" style="padding:10px;">
                <button onclick="addBox()" style="width:auto;">+æ–¹å¡Š</button>
                <button onclick="saveMap()" class="btn-g" style="width:auto;">ç™¼å¸ƒ</button>
                <button onclick="delBox()" class="btn-r" style="width:auto;">åˆªé™¤</button>
            </div>
            <div id="shelf-canvas"></div>
        </div>

        <div id="v-temp" class="hide">
            <div style="padding:10px; background:#e0f7fa;">â„ï¸ å†·è—å€</div>
            <div class="grid" id="g-c"></div>
            <div style="padding:10px; background:#e1f5fe;">ğŸ§Š å†·å‡å€</div>
            <div class="grid" id="g-f"></div>
        </div>

        <div id="v-count" class="hide">
            <div style="padding:10px; background:#fff3e0;">ğŸ“¥ é€²æ«ƒ (ä¸Šä¸€ç­)</div>
            <div style="padding:10px;">
                æ”¶éŠ€ï¼š<input id="in-c" disabled style="width:80px;"> 
                åº«å­˜ï¼š<input id="in-s" disabled style="width:80px;">
                <button id="btn-edit-in" class="hide" onclick="editIn()" style="width:auto; font-size:12px;">ä¿®æ”¹</button>
            </div>
            <div style="padding:10px; background:#e8f5e9;">ğŸª™ é›¢æ«ƒé»ç®—</div>
            <table id="m-table"></table>
            <div style="text-align:right; padding:10px; font-weight:bold; color:blue;">ç¸½è¨ˆ: $<span id="all-sum">0</span></div>
            <hr>
            <input type="number" id="v-sales" placeholder="ç‡Ÿæ¥­é¡" oninput="doAvg()">
            <input type="number" id="v-visit" placeholder="ä¾†å®¢æ•¸" oninput="doAvg()">
            <input type="text" id="v-avg" placeholder="å®¢å–®åƒ¹" readonly style="background:#eee;">
            <button onclick="doCalc()" style="background:orange;">è©¦ç®—èª¤å·®</button>
            <h2 style="text-align:center;">èª¤å·®ï¼š<span id="diff-show">0</span></h2>
            <button onclick="submitRep()" class="btn-g">æäº¤å ±è¡¨</button>
        </div>

        <div id="v-svc" class="hide">
            <div class="grid">
                <button onclick="pop('äº¤æ¥')">äº¤æ¥</button>
                <button onclick="pop('å®¢è¨‚')">å®¢è¨‚</button>
                <button onclick="pop('ç¶­ä¿®')">ç¶­ä¿®</button>
                <button onclick="pop('å”®ç½„')">å”®ç½„</button>
                <button onclick="pop('å ±å»¢')">å ±å»¢</button>
            </div>
            <div id="feed" style="margin-top:10px;"></div>
        </div>
        
        <div id="v-mgr" class="hide">
            <div style="padding:10px; font-weight:bold;">ğŸŒŸ è©•åˆ†</div>
            <select id="mgr-target"><option>é¸å“¡å·¥</option></select>
            <button onclick="saveScore()">å„²å­˜è©•åˆ†</button>
        </div>
    </div>
</div>

<div id="pop-f" class="hide" style="position:fixed; top:20%; left:5%; width:90%; background:white; border:2px solid blue; padding:20px; z-index:3000;">
    <h3 id="pop-t"></h3>
    <div id="pop-i"></div>
    <input type="file" id="pop-p" accept="image/*">
    <button class="btn-g" onclick="send()">é€å‡º</button>
    <button onclick="document.getElementById('pop-f').classList.add('hide')" style="background:#666;">å–æ¶ˆ</button>
</div>
<div id="img-modal" onclick="this.style.display='none'"><img id="big-img"></div>
<div id="bell" onclick="goSvc()">ğŸ””<div id="badge"></div></div>

<script>
// --- 1. Firebase åˆå§‹åŒ– ---
const cfg = {
    apiKey: "AIzaSyAiOKSjZq6TPc9O75NcxsQqFYhY2wziW1w",
    authDomain: "join-home-f3070.firebaseapp.com",
    projectId: "join-home-f3070",
    storageBucket: "join-home-f3070.firebasestorage.app",
    messagingSenderId: "590173788810",
    appId: "1:590173788810:web:13986424ec8bf9a5f7eb73"
};

let db;
const statusDiv = document.getElementById('net-status');

try {
    firebase.initializeApp(cfg);
    db = firebase.firestore();
    
    // å¼·åˆ¶é‡ç½®ç¶²è·¯ (è§£æ±º Client Offline)
    db.disableNetwork().then(() => {
        db.enableNetwork().then(() => {
            statusDiv.innerText = "âœ… ç¶²è·¯å·²é€£ç·š (Ready)";
            statusDiv.style.background = "green";
            statusDiv.style.color = "white";
        });
    });

} catch(e) {
    statusDiv.innerText = "âŒ åˆå§‹åŒ–å¤±æ•—ï¼š" + e.message;
    alert("ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†");
}

let me = null;
let shapes = [];
let selId = null;
let exArr = [];

// --- 2. èªè­‰ ---
function swAuth(x) {
    document.getElementById('b-login').classList.toggle('hide', x);
    document.getElementById('b-reg').classList.toggle('hide', !x);
}

function reg() {
    const btn = document.getElementById('btn-reg');
    btn.innerText = "é€£ç·šä¸­...";
    btn.disabled = true;

    const id = document.getElementById('r-id').value;
    const nm = document.getElementById('r-name').value;
    const pw = document.getElementById('r-pw').value;
    const sf = document.getElementById('r-shift').value;
    
    if(!id||!nm||!pw) {
        btn.innerText = "ç¢ºèªè¨»å†Š"; btn.disabled = false;
        return alert("è«‹å¡«å¯«å®Œæ•´");
    }
    
    // å¯«å…¥è³‡æ–™
    db.collection('users').doc(id).set({name:nm, pw:pw, shift:sf, points:0})
        .then(() => {
            alert("âœ… è¨»å†ŠæˆåŠŸï¼è«‹æŒ‰ç¢ºå®šè¿”å›ç™»å…¥ã€‚");
            btn.innerText = "ç¢ºèªè¨»å†Š"; btn.disabled = false;
            swAuth(false);
        })
        .catch(e => {
            alert("âŒ è¨»å†Šå¤±æ•— (ç¶²è·¯å•é¡Œ): " + e.message);
            btn.innerText = "ç¢ºèªè¨»å†Š"; btn.disabled = false;
        });
}

function login() {
    const id = document.getElementById('lid').value;
    const pw = document.getElementById('lpw').value;
    
    statusDiv.innerText = "æ­£åœ¨é©—è­‰å¸³å¯†...";
    
    db.collection('users').doc(id).get().then(s => {
        if(s.exists && s.data().pw===pw) {
            me = {...s.data(), id};
            statusDiv.innerText = "âœ… æ­¡è¿: " + me.name;
            init();
        } else {
            alert("å¸³å¯†éŒ¯èª¤");
            statusDiv.innerText = "âš ï¸ ç™»å…¥å¤±æ•—";
        }
    }).catch(e => {
        alert("ç„¡æ³•é€£ç·šåˆ°è³‡æ–™åº«: " + e.message);
        statusDiv.innerText = "âŒ ç¶²è·¯éŒ¯èª¤ (Offline)";
    });
}

// --- 3. åˆå§‹åŒ– ---
function init() {
    document.getElementById('p-auth').classList.add('hide');
    document.getElementById('p-main').classList.remove('hide');
    document.getElementById('u-info').innerText = `${me.name} (${me.shift})`;
    
    if(me.shift==='ä¸»ç®¡') {
        document.getElementById('mgr-tool').classList.remove('hide');
        document.getElementById('btn-edit-in').classList.remove('hide');
        document.getElementById('nav-mgr').classList.remove('hide');
    }

    // ç”Ÿæˆè£œè²¨
    const stocks = ['è¸æ¶','å†°ç®±é£²æ–™','å±¤æ¶é£²æ–™','å†·å‡é£Ÿå“','åƒåœ¾è¢‹/å…æ´—','è¡›ç”Ÿç´™'];
    document.getElementById('daily-grid').innerHTML = stocks.map((s,i)=>`<div class="box" id="stk${i}" onclick="chk('stk${i}','${s}')">${s}<br><small>å¾…æª¢</small></div>`).join('');

    // ç”Ÿæˆå†°ç®±
    const gc = document.getElementById('g-c');
    const gf = document.getElementById('g-f');
    for(let i=1; i<=4; i++) gc.innerHTML += `<div class="box" id="fc${i}" onclick="temp('fc${i}','å†·è—${i}','c')">å†·è—${i}</div>`;
    for(let i=1; i<=6; i++) gf.innerHTML += `<div class="box" id="ff${i}" onclick="temp('ff${i}','å†·å‡${i}','f')">å†·å‡${i}</div>`;

    // ç”ŸæˆéŒ¢å¹£
    const mb = document.getElementById('money-b');
    [500,100,50,10,5,1].forEach(u => {
        mb.innerHTML += `<tr>
            <td>${u}</td>
            <td><input type="number" class="inp-m" id="mr${u}" oninput="calc()"></td>
            <td><input type="number" class="inp-m" id="ms${u}" oninput="calc()"></td>
            <td style="color:blue" id="sub${u}">0</td>
        </tr>`;
    });

    listen();
}

function listen() {
    db.collection('checks').onSnapshot(s => {
        s.forEach(d => {
            const el = document.getElementById(d.id);
            if(el) {
                el.className = 'box ok' + (d.id.includes('noodle')||d.id.includes('cookie') ? ' foreign' : '');
                el.innerHTML = `${d.data().name}<br><small>âœ… ${d.data().user}</small>`;
            }
        });
    });
    db.collection('settings').doc('map').onSnapshot(s => {
        if(s.exists) drawMap(s.data().shapes || []);
    });
    db.collection('store').doc('now').onSnapshot(s => {
        if(s.exists) {
            document.getElementById('in-c').value = s.data().cash||0;
            document.getElementById('in-s').value = s.data().stock||0;
        }
    });
    db.collection('feeds').orderBy('time','desc').limit(20).onSnapshot(s => {
        const d = document.getElementById('feed');
        d.innerHTML = "";
        let unread = 0;
        s.forEach(doc => {
            const b = doc.data();
            if(!b.done) unread++;
            d.innerHTML += `<div style="padding:10px; border-bottom:1px solid #ddd; background:${b.done?'#fff':'#fff8e1'}">
                <b>[${b.type}] ${b.user}</b>: ${b.txt}
                ${b.img ? `<br><img src="${b.img}" style="width:80px; margin-top:5px; border:1px solid #ccc;" onclick="zoom('${b.img}')">` : ''}
                <div style="text-align:right; margin-top:5px;">
                    ${!b.done ? `<button onclick="okFeed('${doc.id}')" style="font-size:10px;">å®Œæˆ</button>` : 'âœ…'}
                </div>
            </div>`;
        });
        const badge = document.getElementById('badge');
        if(unread>0) { badge.innerText=unread; badge.style.display='block'; }
        else badge.style.display='none';
    });
}

// --- åŠŸèƒ½å‡½å¼ ---
window.go = (t) => {
    document.querySelectorAll('.nav div').forEach(e=>e.classList.remove('active'));
    document.getElementById('n-'+t).classList.add('active');
    ['stock','temp','count','svc','mgr'].forEach(x=> document.getElementById('v-'+x).classList.add('hide'));
    document.getElementById('v-'+t).classList.remove('hide');
};
window.goSvc = () => go('svc');

window.chk = async (id, name) => {
    if(confirm(name+" å®Œæˆï¼Ÿ")) db.collection('checks').doc(id).set({name, status:'ok', user:me.name});
};

window.temp = async (id, name, type) => {
    const v = prompt(name+" æº«åº¦ï¼š", type==='f'?'-':'');
    if(!v) return;
    if((type==='f' && parseFloat(v)>-10) || (type==='c' && (parseFloat(v)<0 || parseFloat(v)>7))) alert("ğŸš¨ æº«åº¦ç•°å¸¸ï¼");
    db.collection('checks').doc(id).set({name, val:v, status:'ok', user:me.name});
};

window.calc = () => {
    let tot = 0;
    [500,100,50,10,5,1].forEach(u => {
        const r = Number(document.getElementById('mr'+u).value)||0;
        const s = Number(document.getElementById('ms'+u).value)||0;
        const sub = (r+s)*u;
        document.getElementById('sub'+u).innerText = sub;
        tot += sub;
    });
    document.getElementById('all-sum').innerText = tot;
};

window.addEx = (type) => {
    const a = prompt("é‡‘é¡"); const t = prompt("å‚™è¨»");
    if(a) {
        exArr.push({type, amt:Number(a), txt:t});
        document.getElementById('ex-list').innerHTML += `<div style="color:${type==='in'?'green':'red'}">${type==='in'?'æ”¶':'æ”¯'} ${a} (${t})</div>`;
    }
};

window.doAvg = () => {
    const s = Number(document.getElementById('v-sales').value)||0;
    const v = Number(document.getElementById('v-visit').value)||0;
    if(v>0) document.getElementById('v-avg').value = Math.round(s/v);
};

window.doCalc = () => {
    const inC = parseFloat(document.getElementById('in-c').value)||0;
    const inS = parseFloat(document.getElementById('in-s').value)||0;
    const out = parseFloat(document.getElementById('all-sum').innerText)||0;
    const rev = parseFloat(document.getElementById('v-sales').value)||0;
    
    const ded = (parseFloat(document.getElementById('v-cr').value)||0) + 
                (parseFloat(document.getElementById('v-tw').value)||0) + 
                (parseFloat(document.getElementById('v-ln').value)||0) + 
                (parseFloat(document.getElementById('v-pt').value)||0) + 
                (parseFloat(document.getElementById('v-rf').value)||0);
    const ext = exArr.reduce((a,b)=>a+(b.type==='in'?b.amt:-b.amt), 0);

    const diff = ((inC + inS) - out + rev + ext) * -1;
    document.getElementById('diff-val').innerText = diff;
};

window.subRep = async () => {
    const diff = document.getElementById('diff-val').innerText;
    db.collection('reports').add({diff, user:me.name, time:new Date()})
      .then(() => { alert("âœ… æäº¤æˆåŠŸ"); location.reload(); })
      .catch(e => alert("å¤±æ•—:"+e));
};

// äº¤æ¥
let curT = "";
window.pop = (t) => {
    curT = t;
    document.getElementById('pop-f').classList.remove('hide');
    document.getElementById('pop-t').innerText = t;
    const f = document.getElementById('pop-i');
    if(t==='äº¤æ¥') f.innerHTML = `<textarea id="pi-t" placeholder="å…§å®¹..."></textarea>`;
    else f.innerHTML = `<input id="pi-1" placeholder="å“å"><input id="pi-2" placeholder="å‚™è¨»/æ¢ç¢¼">`;
};

window.send = () => {
    let txt = "";
    if(document.getElementById('pi-t')) txt = document.getElementById('pi-t').value;
    else txt = document.getElementById('pi-1').value + " " + document.getElementById('pi-2').value;
    
    const file = document.getElementById('pop-p').files[0];
    const save = (url="") => {
        db.collection('feeds').add({type:curT, txt, img:url, user:me.name, time:new Date(), done:false});
        document.getElementById('pop-f').classList.add('hide');
        alert("å·²ç™¼é€");
    };
    
    if(file) {
        const r = new FileReader();
        r.onload = e => save(e.target.result);
        r.readAsDataURL(file);
    } else save();
};

window.okFeed = (id) => db.collection('feeds').doc(id).update({done:true});
window.zoom = (src) => { 
    document.getElementById('big-img').src = src;
    document.getElementById('img-modal').style.display = 'flex';
};

// æ¨¡å‹åœ–
function drawMap(data) {
    shapes = data;
    const c = document.getElementById('shelf-canvas');
    c.innerHTML = "";
    shapes.forEach((s, i) => {
        const d = document.createElement('div');
        d.style.cssText = `position:absolute; left:${s.x}px; top:${s.y}px; border:2px solid #333; background:${s.done?'green':'rgba(255,255,255,0.8)'}; color:${s.done?'#fff':'#000'}; padding:5px; font-size:10px; cursor:pointer; width:50px; height:40px; display:flex; align-items:center; justify-content:center;`;
        d.innerText = s.name;
        
        if(me.shift==='ä¸»ç®¡') {
            d.onmousedown = e => {
                selId = i;
                document.getElementById('sel-name').innerText = s.name;
                document.getElementById('edit-bar').classList.remove('hide');
                const ox = e.clientX-s.x; const oy = e.clientY-s.y;
                document.onmousemove = ev => { s.x=ev.clientX-ox; s.y=ev.clientY-oy; d.style.left=s.x+'px'; d.style.top=s.y+'px'; };
                document.onmouseup = () => document.onmousemove = null;
            };
        } else {
            d.onclick = () => { if(confirm("å®Œæˆ?")){ s.done=true; saveMap(); } };
        }
        c.appendChild(d);
    });
}
window.addBox = () => { const n=prompt("å"); if(n){ shapes.push({name:n, x:50, y:50, done:false}); saveMap(); }};
window.saveMap = async () => { await db.collection('settings').doc('map').set({shapes}); alert("å·²å„²å­˜"); };
window.delShape = () => { shapes.splice(selId, 1); saveMap(); document.getElementById('edit-bar').classList.add('hide'); };
window.copyShape = () => { const s=shapes[selId]; shapes.push({...s, x:s.x+10, y:s.y+10}); saveMap(); };
window.renShape = () => { const n=prompt("æ–°å"); if(n){ shapes[selId].name=n; saveMap(); }};

window.editIn = () => {
    const v = prompt("æ–°ç¾é‡‘"); const s = prompt("æ–°åº«å­˜");
    if(v&&s) db.collection('store').doc('now').set({cash:v, stock:s});
};
</script>
</body>
</html>