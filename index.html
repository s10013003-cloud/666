!DOCTYPE html
html lang=zh-TW
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no
    titleæ™ºæ…§é–€å¸‚ V44 (7-11 Enterprise)title
    style
         --- 7-Eleven Style Guidelines --- 
        root { --green #008148; --orange #f37920; --red #d32f2f; --gray #f4f4f4; --text #333; }
        body { font-family Microsoft JhengHei, sans-serif; margin 0; background var(--gray); padding-bottom 120px; color var(--text); -webkit-user-select none; user-select none; }
        .container { max-width 600px; margin 0 auto; background #fff; min-height 100vh; box-shadow 0 0 15px rgba(0,0,0,0.1); }

         Nav 
        .nav { display flex; position sticky; top 0; background #fff; border-bottom 3px solid #eee; z-index 100; }
        .nav div { flex 1; padding 15px 0; text-align center; font-weight bold; color #999; cursor pointer; border-bottom 3px solid transparent; transition0.2s; }
        .nav div.active { color var(--green); border-bottom-color var(--green); background #f0fff4; }

         Headers 
        .head { background #fff; padding 15px; margin 10px 0; font-weight 800; border-left 6px solid var(--orange); display flex; justify-content space-between; align-items center; border-bottom 1px solid #eee; }
        
         Box Grid 
        .grid { display grid; grid-template-columns 1fr 1fr; gap 10px; padding 0 12px; }
        .box { border 1px solid #ccc; padding 15px; text-align center; border-radius 6px; cursor pointer; background #fff; min-height 70px; displayflex; flex-directioncolumn; justify-contentcenter; align-itemscenter; position relative; transition0.2s; }
        .boxactive { transform scale(0.97); }
        
         Status States 
        .box.done { background #e8f5e9 !important; border-color var(--green) !important; color #1b5e20; }
        .box.alert { background #ffebee !important; border-color var(--red) !important; color #b71c1c; font-weight bold; animation pulse 2s infinite; }
        .box.priority { border 2px solid var(--orange); }

         Reset Button 
        .reset-btn { position absolute; top 5px; right 5px; width 24px; height 24px; background #fff; border 1px solid #ccc; border-radius 50%; color #666; font-size 14px; line-height 22px; z-index 10; displayflex; justify-contentcenter; align-itemscenter; }
        .reset-btnhover { background var(--red); color white; border-color var(--red); }

         Map 
        #map-area { position relative; width 94%; height 400px; background #eceff1; margin 10px auto; overflow hidden; border 2px solid #cfd8dc; border-radius 4px; }
        .map-box { position absolute; background rgba(255,255,255,0.9); border 2px solid #546e7a; display flex; flex-direction column; align-items center; justify-content center; font-size 11px; cursor pointer; box-shadow 2px 2px 5px rgba(0,0,0,0.2); }
        .map-box.done { border-color var(--green); background #e8f5e9; color var(--green); }
        .map-box.selected { border 3px solid var(--red); z-index 50; transform scale(1.05); }

         Fridge Time Slots 
        .time-grid { display grid; grid-template-columns repeat(3, 1fr); gap 8px; margin-top 10px; }
        .time-btn { padding 8px; border 1px solid #ccc; border-radius 4px; background #fff; text-align center; cursor pointer; font-size 12px; }
        .time-btn.checked { background var(--green); color white; border-color var(--green); }
        .time-btn.missed { background #cfd8dc; color #999; border-color #b0bec5; cursor not-allowed; }  é€¾æ™‚ 
        .time-btn.alert { background var(--red); color white; }  æº«åº¦ç•°å¸¸ 

         Feed 
        .feed-item { padding 12px; border 1px solid #eee; margin-bottom 10px; border-radius 6px; background #fff; border-left 5px solid #ccc; }
        .feed-item.done { border-left-color var(--green); background #f1f8e9; }
        .feed-item.pending { border-left-color var(--red); background #fff3e0; }

         UI Elements 
        input, select, textarea { width 100%; padding 12px; margin 6px 0; border 1px solid #ccc; border-radius 4px; font-size 16px; box-sizing border-box; }
        button { background var(--green); color white; border none; padding 10px; border-radius 4px; font-weight bold; cursor pointer; width 100%; margin-top 5px; }
        .btn-s { width auto; padding 5px 12px; font-size 12px; margin-right 5px; background #555; }
        .btn-r { background var(--red); } .btn-o { background var(--orange); }
        .hide { display none !important; }
        
         Rating 
        .rating-row { display flex; justify-content space-between; align-items center; margin-bottom 10px; border-bottom 1px solid #eee; padding-bottom 5px; }
        .stars span { font-size 28px; color #e0e0e0; cursor pointer; }
        .stars span.gold { color #fbc02d; }

         Modal 
        #modal-overlay { position fixed; top0; left0; width100%; height100%; backgroundrgba(0,0,0,0.8); z-index2000; displaynone; justify-contentcenter; align-itemscenter; }
        .modal-content { backgroundwhite; width90%; max-height90%; overflow-yauto; padding20px; border-radius8px; }
        
        @keyframes pulse { 0%{box-shadow 0 0 0 0 rgba(211, 47, 47, 0.4);} 70%{box-shadow 0 0 0 10px rgba(211, 47, 47, 0);} 100%{box-shadow 0 0 0 0 rgba(211, 47, 47, 0);} }
    style
head
body

div id=modal-overlaydiv class=modal-content id=modal-bodydivdiv

div class=container
    div id=page-auth style=padding40px 20px; text-aligncenter;
        h2 style=colorvar(--green); letter-spacing 2px;7-ELEVEn Systemh2
        p style=color#666Store Operation V44p
        div id=box-login style=margin-top30px;
            input id=l-id placeholder=å“¡å·¥ç·¨è™Ÿ
            input id=l-pw type=password placeholder=å¯†ç¢¼
            button onclick=login()ç™»å…¥ç³»çµ±button
            p onclick=swAuth(true) style=colorblue; margin-top20px; cursorpointer;è¨»å†Šå¸³è™Ÿp
        div
        div id=box-reg class=hide style=margin-top30px;
            input id=r-name placeholder=çœŸå¯¦å§“å
            select id=r-shiftoptionæ—©ç­optionoptionæ™šç­optionoptionä¸»ç®¡optionselect
            input id=r-id placeholder=è¨­å®šç·¨è™Ÿ
            input id=r-pw type=password placeholder=è¨­å®šå¯†ç¢¼
            button class=btn-g onclick=reg()ç¢ºèªè¨»å†Šbutton
            p onclick=swAuth(false) style=colorblue; margin-top20px; cursorpointer;è¿”å›ç™»å…¥p
        div
    div

    div id=page-main class=hide
        div style=background#333; colorwhite; padding10px; displayflex; justify-contentspace-between; align-itemscenter;
            spanğŸª span id=user-info--spanspan
            button onclick=logout() class=btn-sç™»å‡ºbutton
        div

        div class=nav
            div onclick=tab('stock') id=n-stock class=activeè£œè²¨div
            div onclick=tab('expiry') id=n-expiryæ•ˆæœŸdiv
            div onclick=tab('temp') id=n-tempå†°ç®±div
            div onclick=tab('count') id=n-countå¸³å‹™div
            div onclick=tab('svc') id=n-svcå®¢æœdiv
            div onclick=tab('mgr') id=n-mgr class=hideä¸»ç®¡div
        div

        div id=v-stock
            div class=head style=border-colorvar(--red);ğŸ”¥ é‡é»è£œè²¨div
            div class=grid
                div class=box priority alert id=s_noodle onclick=doCheck('s_noodle','å¤–ç±æ³¡éºµ')å¤–ç±æ³¡éºµbrsmallå¾…è™•ç†smalldiv
                div class=box priority alert id=s_cookie onclick=doCheck('s_cookie','å¤–ç±é¤…ä¹¾')å¤–ç±é¤…ä¹¾brsmallå¾…è™•ç†smalldiv
            div

            div class=head
                ğŸ›’ æ¯æ—¥è£œè²¨ 
                button id=btn-add-stock class=hide btn-s onclick=addItem('stock')+æ–°å¢button
            div
            div class=grid id=stock-listdiv
        div

        div id=v-expiry class=hide
            div class=headğŸ“… æ¯æ—¥æ•ˆæœŸæª¢æŸ¥div
            div class=grid
                div class=box alert id=ex_bread onclick=doCheck('ex_bread','éºµåŒ…')éºµåŒ…brsmallå¾…æª¢smalldiv
                div class=box alert id=ex_drink onclick=doCheck('ex_drink','æ—¥é…é£²æ–™')æ—¥é…é£²æ–™brsmallå¾…æª¢smalldiv
                div class=box alert id=ex_veg onclick=doCheck('ex_veg','ç”Ÿé®®è”¬èœ')ç”Ÿé®®è”¬èœbrsmallå¾…æª¢smalldiv
            div

            div class=head
                ğŸ—“ï¸ æ¯æœˆæ•ˆæœŸåœ–
                div id=map-tools class=hide
                    button class=btn-s btn-g onclick=addMapBox()+æ–¹æ ¼button
                    button class=btn-s btn-o onclick=toggleMapEdit()âœï¸ span id=map-mode-txtç·¨è¼¯é—œspanbutton
                div
            div
            div id=map-areadiv
        div

        div id=v-temp class=hide
            div class=head
                â„ï¸ å†°ç®±æº«åº¦ (æ™‚æ®µæª¢æ ¸)
                button id=btn-add-fridge class=hide btn-s onclick=addItem('fridge')+æ–°å¢button
            div
            div style=padding0 10px; font-size12px; color#666; é€¾æ™‚1å°æ™‚å°‡é–å®šç‚ºã€Œæœªæª¢ã€div
            div class=grid id=fridge-listdiv
        div

        div id=v-count class=hide
            div class=headğŸ“¥ ä¸Šç­ç•™å­˜ (ä¸»ç®¡å¯ä¿®)div
            div style=padding10px; background#fff; margin10px; border1px solid #ccc;
                æ”¶éŠ€ç•™åº•ï¼šinput type=number id=in-cash disabled style=width100px; displayinline-block
                é‡‘åº«ç•™åº•ï¼šinput type=number id=in-vault disabled style=width100px; displayinline-block
                button id=btn-unlock-in class=hide btn-s btn-o style=margin-top5px; onclick=unlockIn()ä¿®æ­£button
                button id=btn-save-in class=hide btn-s btn-g style=margin-top5px; onclick=saveIn()å„²å­˜button
            div

            div class=headğŸª™ äº¤ç­é»ç®—div
            table
                trthå¹£å€¼ththæ”¶éŠ€ththé‡‘åº«ththå°è¨ˆthtr
                tbody id=money-tabletbody
                trtd colspan=3bç¸½è¨ˆbtdtd id=total-money style=colorblue; font-weightbold;0tdtr
            table

            div class=headğŸ“ é›»è©±å¡div
            div id=card-list class=griddiv

            div class=headğŸ“Š ç‡Ÿæ”¶çµç®—div
            div class=grid
                input type=number id=v-rev placeholder=ç‡Ÿæ¥­é¡ oninput=doCalc()
                input type=number id=v-vis placeholder=ä¾†å®¢æ•¸ oninput=doCalc()
                input type=text id=v-avg placeholder=å®¢å–®åƒ¹ readonly style=background#eee;
            div
            
            div class=headèª¤å·®ï¼šspan id=diff-show style=font-weightbold;0spandiv
            button class=btn-g onclick=submitShift()âœ… æäº¤äº¤ç­å ±è¡¨button
        div

        div id=v-svc class=hide
            div class=grid
                button onclick=popSvc('äº¤æ¥')ğŸ“ äº¤æ¥äº‹é …button
                button onclick=popSvc('å®¢è¨‚')ğŸ›’ å®¢è¨‚ç™»è¨˜button
                button onclick=popSvc('ç¶­ä¿®')ğŸ”§ å ±ä¿®ç™»è¨˜button
                button onclick=popSvc('è©¢å•')â“ é¡§å®¢è©¢å•button
            div
            div id=feed-area style=margin-top15px;div
        div

        div id=v-mgr class=hide
            div class=headğŸŒŸ å“¡å·¥ KPI è©•æ ¸div
            select id=mgr-usersoptioné¸æ“‡å“¡å·¥...optionselect
            div style=padding15px; background#fff; border1px solid #ddd; margin-top10px;
                div class=rating-rowSOP åŸ·è¡Œç‡ span class=stars data-c=1 onclick=rate(this,event)â˜…â˜…â˜…â˜…â˜…spandiv
                div class=rating-rowå®¢è¨´æœå‹™ span class=stars data-c=2 onclick=rate(this,event)â˜…â˜…â˜…â˜…â˜…spandiv
                div class=rating-rowå‡ºå‹¤ç‹€æ³ span class=stars data-c=3 onclick=rate(this,event)â˜…â˜…â˜…â˜…â˜…spandiv
                div class=rating-rowåœ˜éšŠç²¾ç¥ span class=stars data-c=4 onclick=rate(this,event)â˜…â˜…â˜…â˜…â˜…spandiv
                textarea id=mgr-comment placeholder=ä¸»ç®¡è©•èª... style=height60px;textarea
                button class=btn-g onclick=saveRating()é€å‡ºè©•æ ¸button
            div
        div
    div
div

script
 --- V44 Core Logic ---
const DB = {
    get (k) = JSON.parse(localStorage.getItem(k)  '{}'),
    set (k, v) = localStorage.setItem(k, JSON.stringify(v)),
    arr (k) = JSON.parse(localStorage.getItem(k)  '[]'),
    push (k, v) = {
        let a = JSON.parse(localStorage.getItem(k)  '[]');
        a.unshift(v);
        localStorage.setItem(k, JSON.stringify(a));
    }
};

 6. Typo Fix & Init
const initData = () = {
    if(!localStorage.getItem('v44_stock')) {
        localStorage.setItem('v44_stock', JSON.stringify(['å†°ç®±é£²æ–™','å±¤æ¶é£²æ–™','è¸æ¶','é›»æ± ','æ³¡éºµé¤…ä¹¾','åƒåœ¾è¢‹å…æ´—é¤å…·','ç™¾è²¨ç”¨å“']));
    }
    if(!localStorage.getItem('v44_fridge')) {
        localStorage.setItem('v44_fridge', JSON.stringify([
            {n'é–‹æ”¾å¼1',t'c'},{n'é–‹æ”¾å¼2',t'c'},{n'å†·è—æ«¥æ«ƒ1',t'c'},{n'å†·è—æ«¥æ«ƒ2',t'c'},
            {n'å†·å‡æ«¥æ«ƒ1',t'f'},{n'å†·å‡æ«¥æ«ƒ2',t'f'},{n'è‡¥å¼å†°ç®±1',t'f'},{n'è‡¥å¼å†°ç®±2',t'f'},{n'è‡¥å¼å†°ç®±3',t'f'},{n'è‡¥å¼å†°ç®±4',t'f'}
        ]));
    }
}
initData();

let me = null;
let shapes = DB.arr('map_shapes');
let selShapeIdx = null;
let imgBase64 = ;
let isMapEdit = false;
const fridgeTimes = [1030,1230,1430,1630,1830,2030,2200];

 --- Auth ---
function swAuth(reg) { document.getElementById('box-login').classList.toggle('hide', reg); document.getElementById('box-reg').classList.toggle('hide', !reg); }
function reg() {
    const id=document.getElementById('r-id').value, nm=document.getElementById('r-name').value, pw=document.getElementById('r-pw').value;
    if(!id!nm!pw) return alert(è«‹å¡«å¯«);
    let u=DB.get('users'); u[id]={namenm, pwpw, shiftdocument.getElementById('r-shift').value}; DB.set('users', u);
    alert(è¨»å†ŠæˆåŠŸ); swAuth(false);
}
function login() {
    const id=document.getElementById('l-id').value, pw=document.getElementById('l-pw').value;
    let u=DB.get('users');
    if(u[id] && u[id].pw===pw) { me={...u[id], id}; startApp(); } else alert(å¸³å¯†éŒ¯èª¤);
}
function logout() { location.reload(); }

function startApp() {
    document.getElementById('page-auth').classList.add('hide');
    document.getElementById('page-main').classList.remove('hide');
    document.getElementById('user-info').innerText = `${me.name}(${me.shift})`;

    if(me.shift==='ä¸»ç®¡') {
        document.querySelectorAll('.hide').forEach(el={
            if(el.id.includes('mgr')  el.id.includes('btn-add')  el.id.includes('map-tools')  el.id.includes('unlock')) el.classList.remove('hide');
        });
        loadUserList();
    }
    
    renderStock();
    renderFridge();
    renderMoney();
    renderCards();
    renderFeed();
    drawMap();
    renderStatus();
}

function tab(t) {
    document.querySelectorAll('.nav div').forEach(e=e.classList.remove('active'));
    document.getElementById('n-'+t).classList.add('active');
    ['stock','expiry','temp','count','svc','mgr'].forEach(x=document.getElementById('v-'+x).classList.add('hide'));
    document.getElementById('v-'+t).classList.remove('hide');
}

 --- 1. Stock & Expiry CheckReset ---
function renderStock() {
    const list = JSON.parse(localStorage.getItem('v44_stock'));
    document.getElementById('stock-list').innerHTML = list.map((s,i) = `
        div class=box alert id=stk_${i} onclick=doCheck('stk_${i}','${s}')
            ${s}brsmallå¾…æª¢small
            ${me.shift==='ä¸»ç®¡'  `div class=reset-btn onclick=resetCheck('stk_${i}');event.stopPropagation()â†»div`  ''}
        div`).join('');
}

function doCheck(id, name) {
    let s = DB.get('status');
    if(s[id] && !s[id].alert && !confirm(å·²å®Œæˆã€‚æ˜¯å¦è¦†è“‹ï¼Ÿ)) return;
    if(!s[id] && !confirm(`ç¢ºèªå®Œæˆ ${name}ï¼Ÿ`)) return;
    
    s[id] = {name, userme.name, timenew Date().toLocaleTimeString(), alertfalse};
    DB.set('status', s);
    renderStatus();
}

function resetCheck(id) {
    if(!confirm(ç¢ºå®šé‡ç½®ç‚ºæœªå®Œæˆï¼Ÿ)) return;
    let s = DB.get('status'); delete s[id]; DB.set('status', s);
    if(id.includes('stk_')) renderStock(); else {
        const el=document.getElementById(id); 
        el.className=`box alert ${id.includes('s_')'priority'''}`;
        el.innerHTML=`${el.innerText.split('n')[0]}brsmallå¾…è™•ç†small
        ${me.shift==='ä¸»ç®¡'  `div class=reset-btn onclick=resetCheck('${id}');event.stopPropagation()â†»div`  ''}`;
    }
    renderStatus();
}

function renderStatus() {
    let s = DB.get('status');
    for(let k in s) {
        const el = document.getElementById(k);
        if(el && s[k]) {
            el.className = `box ${s[k].alert'alert''done'} ${k.includes('s_')'priority'''}`;
            el.innerHTML = `${s[k].name}brsmall${s[k].alert'âš ï¸ ç•°å¸¸''âœ… '+s[k].user+' '+s[k].time}small
            ${me.shift==='ä¸»ç®¡'  `div class=reset-btn onclick=resetCheck('${k}');event.stopPropagation()â†»div`  ''}`;
        }
    }
    let st=DB.get('store');
    document.getElementById('in-cash').value=st.cash0; document.getElementById('in-vault').value=st.vault0;
    if(st.cards) for(let k in st.cards) document.getElementById(`cd_l_${k}`).placeholder = `ä¸Š${st.cards[k]}`;
}

 --- 2. Map Editor (Full Control) ---
function toggleMapEdit() { isMapEdit = !isMapEdit; document.getElementById('map-mode-txt').innerText = isMapEditç·¨è¼¯é–‹ç·¨è¼¯é—œ; drawMap(); }

function drawMap() {
    const area = document.getElementById('map-area'); area.innerHTML = ;
    shapes = DB.arr('map_shapes');
    shapes.forEach((s, i) = {
        const el = document.createElement('div');
        el.className = `map-box ${s.done'done'''} ${selShapeIdx===i && isMapEdit'selected'''}`;
        el.style.left=s.x+'px'; el.style.top=s.y+'px'; el.style.width=(s.w60)+'px'; el.style.height=(s.h60)+'px';
        
        let info = s.name;
        if(s.date) {
            const days = Math.ceil((new Date(s.date)-new Date())(1000606024));
            info += `brspan style=color${days3'red''green'}${days}å¤©span`;
        }
        if(s.done) info += `brspan style=font-size9pxâœ…${s.checker} ${s.checkTime}span`;
        if(s.done) el.style.background = getUserColor(s.checker);  5. Different user color

        el.innerHTML = info;
        
        el.onclick = (e) = {
            e.stopPropagation();
            if(isMapEdit && me.shift==='ä¸»ç®¡') {
                selShapeIdx = i; editMapBox(); drawMap();
            } else {
                if(confirm(`${s.name} æª¢æŸ¥å®Œæˆï¼Ÿ`)) { s.done=true; s.checker=me.name; s.checkTime=new Date().toLocaleTimeString(); saveMap(); }
            }
        };
         Drag
        if(isMapEdit && me.shift==='ä¸»ç®¡') {
            el.onmousedown = (e) = {
                const sx=e.clientX-s.x, sy=e.clientY-s.y;
                document.onmousemove = (ev) = { s.x=ev.clientX-sx; s.y=ev.clientY-sy; el.style.left=s.x+'px'; el.style.top=s.y+'px'; };
                document.onmouseup = () = { document.onmousemove=null; saveMap(); };
            };
        }
        area.appendChild(el);
    });
}
function editMapBox() {
    const action = prompt(ç·¨è¼¯æ–¹æ ¼n1.æ”¹å 2.å¤§å° 3.æœŸé™ 4.åˆªé™¤);
    if(action==='1') { const n=prompt(å,shapes[selShapeIdx].name); if(n) shapes[selShapeIdx].name=n; }
    else if(action==='2') { const w=prompt(å¯¬,shapes[selShapeIdx].w), h=prompt(é«˜,shapes[selShapeIdx].h); if(w) shapes[selShapeIdx].w=parseInt(w); if(h) shapes[selShapeIdx].h=parseInt(h); }
    else if(action==='3') { const d=prompt(æ—¥æœŸ(YYYY-MM-DD),shapes[selShapeIdx].date); if(d) shapes[selShapeIdx].date=d; }
    else if(action==='4') { if(confirm(åˆª)) shapes.splice(selShapeIdx,1); }
    saveMap();
}
function addMapBox() { const n=prompt(å); if(n) { shapes.push({namen,x50,y50,w60,h60,donefalse}); saveMap(); }}
function saveMap() { localStorage.setItem('map_shapes', JSON.stringify(shapes)); drawMap(); }
function getUserColor(name) {
    let hash = 0; for (let i = 0; i  name.length; i++) hash = name.charCodeAt(i) + ((hash  5) - hash);
    return `hsla(${hash % 360}, 70%, 80%, 0.9)`;
}

 --- 4. Fridge Time Logic ---
function renderFridge() {
    const list = JSON.parse(localStorage.getItem('v44_fridge'));
    document.getElementById('fridge-list').innerHTML = list.map((f,i) = `
        div class=box alert id=ref_${i} onclick=openFridgeModal('ref_${i}','${f.n}','${f.t}')
            ${f.n}brsmallå¾…æ¸¬small
            ${me.shift==='ä¸»ç®¡'  `div class=reset-btn onclick=delConfItem('fridge',${i});event.stopPropagation()-div`  ''}
        div
    `).join('');
}

function openFridgeModal(id, name, type) {
    document.getElementById('modal-overlay').style.display='flex';
    let s = DB.get('status');
    const now = new Date();
    const curMin = now.getHours()60 + now.getMinutes();
    
    let html = `h3${name}h3div class=time-grid`;
    fridgeTimes.forEach(time = {
        const key = `${id}_${time.replace('','')}`;
        const tParts = time.split('');
        const tMin = parseInt(tParts[0])60 + parseInt(tParts[1]);
        const data = s[key];
        
         Logic Missed if  60 mins past
        let status = '';
        if(data) status = data.alert  'alert'  'checked';
        else if (curMin  tMin + 60) status = 'missed';
        
        html += `div class=time-btn ${status} onclick=${status==='missed''alert('é€¾æ™‚ç„¡æ³•å¡«å¯«')'`saveTemp('${key}','${time}','${name}','${type}')`}
            ${time}br${status==='missed''MISS'(datadata.val'--')}
        div`;
    });
    html += `divbutton class=btn-r style=margin-top10px onclick=document.getElementById('modal-overlay').style.display='none'é—œé–‰button`;
    document.getElementById('modal-body').innerHTML = html;
}

function saveTemp(key, time, name, type) {
    const v = prompt(`${name} ${time} æº«åº¦`, type==='f''-''');
    if(v===null) return;
    if(v.trim()===  isNaN(Number(v))) return alert(âŒ ç„¡æ•ˆæ•¸å­—);
    const n=parseFloat(v);
    let alertFlag=false;
    if((type==='c' && (n0  n7))  (type==='f' && (n-10  n-30))) { alert(ğŸš¨ æº«åº¦ç•°å¸¸); alertFlag=true; }
    
    let s=DB.get('status');
    s[key] = {name`${name} ${time}`, userme.name, valv+Â°C, alertalertFlag};
    DB.set('status', s);
    openFridgeModal(key.split('_').slice(0,2).join('_'), name, type);
}

 --- 3. Svc & Image ---
function popSvc(t) {
    document.getElementById('modal-overlay').style.display='flex';
    let html = `h3${t}h3div id=modal-fields`;
    if(t==='å®¢è¨‚') html+=`input id=f1 placeholder=å“åinput id=f2 placeholder=æ¢ç¢¼input id=f3 placeholder=æ•¸é‡input id=f4 placeholder=å”®åƒ¹hrinput id=f5 placeholder=å®¢åinput id=f6 placeholder=é›»è©±`;
    else html+=`textarea id=f1 placeholder=å…§å®¹... style=height100pxtextarea`;
    html += `divdiv style=margin-top10pxinput type=file id=modal-img accept=image onchange=readImg()div
    button onclick=saveSvc('${t}')é€å‡ºbuttonbutton class=btn-s onclick=document.getElementById('modal-overlay').style.display='none'å–æ¶ˆbutton`;
    document.getElementById('modal-body').innerHTML = html;
    imgBase64=;
}
function readImg() {
    const f=document.getElementById('modal-img').files[0];
    if(f) { const r=new FileReader(); r.onload=e={ imgBase64=e.target.result; }; r.readAsDataURL(f); }
}
function saveSvc(t) {
    let txt=; document.querySelectorAll('#modal-fields input, #modal-fields textarea').forEach(i={ if(i.value) txt+=i.placeholder++i.value+br; });
    if(!txt && !imgBase64) return alert(ç©ºç™½);
    DB.push('feeds', {typet, txt, imgimgBase64, userme.name, timenew Date().toLocaleString(), donefalse});
    alert(æˆåŠŸ); document.getElementById('modal-overlay').style.display='none'; renderFeed();
}
function renderFeed() {
    const d=document.getElementById('feed-area'); d.innerHTML=;
    DB.arr('feeds').forEach((f,i)={
        d.innerHTML += `div class=feed-item ${f.done'done''pending'}
            b${f.type}b ${f.user} ${f.time}br${f.txt}
            ${f.img`img src=${f.img} style=width60px;margin-top5px onclick=document.getElementById('big-img').src='${f.img}';document.getElementById('img-zoom').style.display='flex'`''}
            div style=text-alignrightbutton class=btn-s onclick=let fs=DB.arr('feeds');fs[${i}].done=!fs[${i}].done;localStorage.setItem('feeds',JSON.stringify(fs));renderFeed()${f.done'é‡é–‹''å®Œæˆ'}buttondiv
        div`;
    });
}

 --- Finance ---
function renderMoney(){ document.getElementById('money-table').innerHTML=[500,100,50,10,5,1].map(u=`trtd${u}tdtdinput type=number class=inp-money id=mr_${u} oninput=cM()tdtdinput type=number class=inp-money id=mv_${u} oninput=cM()tdtd id=sub_${u} style=colorblue0tdtr`).join(''); }
function renderCards(){ document.getElementById('card-list').innerHTML=[IF499,OK499,ä¸­è¯499,IF599,OK599,ä¸­è¯599,æ—ºå¡].map(c=`div class=box style=padding5pxb${c}bdiv style=displayflex;gap5pxinput type=number id=cd_s_${c} placeholder=éŠ· style=width50%input type=number id=cd_l_${c} placeholder=å­˜ style=width50%divdiv`).join(''); }
function cM(){ let t=0; [500,100,50,10,5,1].forEach(u={ let r=Number(document.getElementById(`mr_${u}`).value)0, v=Number(document.getElementById(`mv_${u}`).value)0; document.getElementById(`sub_${u}`).innerText=(r+v)u; t+=(r+v)u; }); document.getElementById('total-money').innerText=t; doCalc(); }
function doCalc(){ 
    const inC=Number(document.getElementById('in-cash').value)0, inV=Number(document.getElementById('in-vault').value)0, cnt=Number(document.getElementById('total-money').innerText)0, rev=Number(document.getElementById('v-rev').value)0; 
    let diff=cnt-(inC+inV+rev); document.getElementById('diff-show').innerText=diff; document.getElementById('diff-show').style.color=diff===0'green''red'; 
}
function unlockIn(){ document.getElementById('in-cash').disabled=false; document.getElementById('in-vault').disabled=false; }
function saveIn(){ DB.set('store', {cashdocument.getElementById('in-cash').value, vaultdocument.getElementById('in-vault').value}); alert(å·²å„²å­˜); }
function submitShift(){ 
    let s=DB.get('store'); s.cash=parseFloat(document.getElementById('total-money').innerText); 
    [IF499,OK499,ä¸­è¯499,IF599,OK599,ä¸­è¯599,æ—ºå¡].forEach(c={ if(!s.cards) s.cards={}; s.cards[c]=document.getElementById(`cd_l_${c}`).value0; });
    DB.set('store',s); alert(äº¤ç­æˆåŠŸ); location.reload(); 
}

 --- 4. Rating ---
function loadUserList(){ let u=DB.get('users'),s=document.getElementById('mgr-users'); for(let k in u) if(u[k].shift!=='ä¸»ç®¡'){ let o=document.createElement('option'); o.value=k; o.innerText=u[k].name; s.appendChild(o); }}
function rate(s,e){ s.parentNode.querySelectorAll('span').forEach((el,i)=el.className=ie.target.cellIndex'gold'''); }
function saveRating(){ if(!document.getElementById('mgr-users').value) return alert(é¸å“¡å·¥); alert(è©•åˆ†å·²å„²å­˜); }
function addEx(t){ let a=prompt(é¡); if(a) document.getElementById('ex-list').innerHTML+=`div${t=='in''æ”¶''æ”¯'} $${a}div`; }
function addItem(t){ let k=`v44_${t}`, l=JSON.parse(localStorage.getItem(k)); let n=prompt(å); if(n) { if(t=='fridge') l.push({n,t'c'}); else l.push(n); localStorage.setItem(k,JSON.stringify(l)); startApp(); }}
function delConfItem(t,i){ if(confirm(åˆª)) { let k=`v44_${t}`, l=JSON.parse(localStorage.getItem(k)); l.splice(i,1); localStorage.setItem(k,JSON.stringify(l)); startApp(); }}
function gotoSvc(){ tab('svc'); }
function closeZoom(){ document.getElementById('img-zoom').style.display='none'; }
script
body
html